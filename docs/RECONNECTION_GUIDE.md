# EasyRemote é‡è¿æœºåˆ¶æ”¹è¿›æŒ‡å—

## ğŸ”§ é—®é¢˜è§£å†³

### åŸå§‹é—®é¢˜
å½“æœåŠ¡å™¨æ‰çº¿å¹¶é‡æ–°ä¸Šçº¿åï¼ŒèŠ‚ç‚¹æ— æ³•è‡ªåŠ¨é‡è¿æ¥ä¸Šå»ã€‚

### è§£å†³æ–¹æ¡ˆ
æˆ‘ä»¬å¯¹ `ComputeNode` è¿›è¡Œäº†å…¨é¢æ”¹è¿›ï¼Œå®ç°äº†å¼ºå¥çš„è‡ªåŠ¨é‡è¿æœºåˆ¶ã€‚

## âœ¨ æ”¹è¿›åŠŸèƒ½

### 1. æ™ºèƒ½é‡è¿ç­–ç•¥
- **æŒ‡æ•°é€€é¿ç®—æ³•**: é‡è¿é—´éš”ä¼šé€æ¸å¢åŠ  (2ç§’ â†’ 4ç§’ â†’ 8ç§’ â†’ ...)ï¼Œæœ€å¤§60ç§’
- **æœ€å¤§é‡è¯•é™åˆ¶**: å¯é…ç½®æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œé¿å…æ— é™é‡è¯•
- **è¿æ¥çŠ¶æ€è¿½è¸ª**: å®æ—¶ç›‘æ§è¿æ¥å¥åº·çŠ¶æ€

### 2. å¢å¼ºçš„è¿æ¥æ£€æµ‹
- **ä¸»åŠ¨å¥åº·æ£€æŸ¥**: å®šæœŸæ£€æŸ¥gRPCé€šé“çŠ¶æ€
- **å¿ƒè·³è¶…æ—¶æ£€æµ‹**: å½“å¿ƒè·³å“åº”è¶…æ—¶æ—¶ä¸»åŠ¨æ–­å¼€é‡è¿
- **è¿æ¥çŠ¶æ€ç›‘æ§**: æ£€æµ‹ TRANSIENT_FAILURE å’Œ SHUTDOWN çŠ¶æ€

### 3. ä¼˜åŒ–çš„gRPCé…ç½®
- **æ›´çŸ­çš„keepaliveé—´éš”**: 20ç§’å¿ƒè·³ï¼Œ3ç§’è¶…æ—¶
- **TCPè¿æ¥ä¼˜åŒ–**: æ·»åŠ TCPç”¨æˆ·è¶…æ—¶å’Œsocketé‡ç”¨
- **æ›´å¿«çš„æ•…éšœæ£€æµ‹**: 5ç§’pingé—´éš”

### 4. å®Œå–„çš„èµ„æºç®¡ç†
- **å¼ºåˆ¶æ¸…ç†æœºåˆ¶**: ç¡®ä¿æ—§è¿æ¥å®Œå…¨é‡Šæ”¾
- **ä»»åŠ¡å–æ¶ˆ**: ä¼˜é›…å–æ¶ˆæ‰€æœ‰æ‰§è¡Œä¸­çš„ä»»åŠ¡
- **å†…å­˜æ³„æ¼é˜²æŠ¤**: æ¸…ç†é˜Ÿåˆ—å’Œå¼‚æ­¥ä»»åŠ¡

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### åŸºç¡€é…ç½®

```python
from easyremote import ComputeNode

node = ComputeNode(
    vps_address="your-server:8080",
    node_id="my-robust-node",
    # é‡è¿é…ç½®
    reconnect_interval=3,           # åŸºç¡€é‡è¿é—´éš”
    max_retry_attempts=10,          # æœ€å¤§é‡è¯•æ¬¡æ•°
    # å¥åº·æ£€æŸ¥é…ç½®
    heartbeat_interval=5,           # å¿ƒè·³é—´éš”
    heartbeat_timeout=15,           # å¿ƒè·³è¶…æ—¶
    health_check_interval=30,       # å¥åº·æ£€æŸ¥é—´éš”
    connection_timeout=10,          # è¿æ¥è¶…æ—¶
)
```

### é«˜å¯ç”¨é…ç½®

```python
node = ComputeNode(
    vps_address="your-server:8080",
    node_id="high-availability-node",
    # æ›´æ¿€è¿›çš„é‡è¿ç­–ç•¥
    reconnect_interval=1,           # 1ç§’å¿«é€Ÿé‡è¿
    max_retry_attempts=20,          # æ›´å¤šé‡è¯•æ¬¡æ•°
    # æ›´é¢‘ç¹çš„å¥åº·æ£€æŸ¥
    heartbeat_interval=2,           # 2ç§’å¿ƒè·³
    heartbeat_timeout=8,            # 8ç§’å¿ƒè·³è¶…æ—¶
    health_check_interval=10,       # 10ç§’å¥åº·æ£€æŸ¥
    connection_timeout=5,           # 5ç§’è¿æ¥è¶…æ—¶
    # æ€§èƒ½ä¼˜åŒ–
    execution_timeout=120,          # 2åˆ†é’Ÿæ‰§è¡Œè¶…æ—¶
    max_queue_size=1000            # å¤§é˜Ÿåˆ—
)
```

### ç½‘ç»œä¸ç¨³å®šç¯å¢ƒé…ç½®

```python
node = ComputeNode(
    vps_address="remote-server:8080",
    node_id="unstable-network-node",
    # æ›´å®½æ¾çš„é‡è¿ç­–ç•¥
    reconnect_interval=5,           # 5ç§’é‡è¿é—´éš”
    max_retry_attempts=50,          # å¤§é‡é‡è¯•
    # æ›´å®½æ¾çš„è¶…æ—¶è®¾ç½®
    heartbeat_interval=10,          # 10ç§’å¿ƒè·³
    heartbeat_timeout=30,           # 30ç§’å¿ƒè·³è¶…æ—¶
    health_check_interval=60,       # 1åˆ†é’Ÿå¥åº·æ£€æŸ¥
    connection_timeout=20,          # 20ç§’è¿æ¥è¶…æ—¶
)
```

## ğŸ§ª æµ‹è¯•é‡è¿åŠŸèƒ½

### 1. è¿è¡Œæ¼”ç¤ºç¨‹åº

```bash
# 1. å¯åŠ¨æœåŠ¡å™¨
python examples/vps_server.py

# 2. å¯åŠ¨æ”¹è¿›çš„èŠ‚ç‚¹ï¼ˆæ–°ç»ˆç«¯ï¼‰
python examples/improved_reconnect_demo.py

# 3. è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯ï¼ˆæ–°ç»ˆç«¯ï¼‰
python examples/test_reconnect_client.py
```

### 2. æµ‹è¯•åœºæ™¯

#### åœºæ™¯1: æœåŠ¡å™¨é‡å¯
1. å¯åŠ¨èŠ‚ç‚¹å’ŒæœåŠ¡å™¨
2. åœæ­¢æœåŠ¡å™¨ (Ctrl+C)
3. è§‚å¯ŸèŠ‚ç‚¹é‡è¿å°è¯•
4. é‡å¯æœåŠ¡å™¨
5. éªŒè¯èŠ‚ç‚¹è‡ªåŠ¨é‡è¿æˆåŠŸ

#### åœºæ™¯2: ç½‘ç»œä¸­æ–­æ¨¡æ‹Ÿ
1. ä½¿ç”¨é˜²ç«å¢™é˜»æ–­ç«¯å£
2. è§‚å¯ŸèŠ‚ç‚¹çš„é‡è¿è¡Œä¸º
3. æ¢å¤ç½‘ç»œè¿æ¥
4. éªŒè¯åŠŸèƒ½æ¢å¤

#### åœºæ™¯3: é•¿æ—¶é—´æ–­å¼€
1. é•¿æ—¶é—´åœæ­¢æœåŠ¡å™¨ï¼ˆè¶…è¿‡å¿ƒè·³è¶…æ—¶ï¼‰
2. è§‚å¯ŸèŠ‚ç‚¹æ˜¯å¦æ­£ç¡®æ£€æµ‹åˆ°æ–­å¼€
3. é‡å¯æœåŠ¡å™¨
4. éªŒè¯é‡è¿å’ŒåŠŸèƒ½æ¢å¤

### 3. è¿ç»­æµ‹è¯•

ä½¿ç”¨æµ‹è¯•å®¢æˆ·ç«¯çš„æŒç»­æµ‹è¯•æ¨¡å¼ï¼š

```bash
python examples/test_reconnect_client.py
# é€‰æ‹©é€‰é¡¹ 2: æŒç»­æµ‹è¯•
```

è¿™å°†æ¯10ç§’è¿è¡Œä¸€æ¬¡å‡½æ•°è°ƒç”¨æµ‹è¯•ï¼Œè®©ä½ å¯ä»¥å®æ—¶è§‚å¯Ÿé‡è¿å‰åçš„åŠŸèƒ½çŠ¶æ€ã€‚

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—çº§åˆ«
- **INFO**: è¿æ¥çŠ¶æ€å˜åŒ–ã€é‡è¿å°è¯•
- **WARNING**: å¿ƒè·³è¶…æ—¶ã€è¿æ¥å¼‚å¸¸
- **ERROR**: è¿æ¥å¤±è´¥ã€å‡½æ•°æ‰§è¡Œé”™è¯¯
- **DEBUG**: è¯¦ç»†çš„ç½‘ç»œäº¤äº’ä¿¡æ¯

### å…³é”®æ—¥å¿—æ¶ˆæ¯

```
# æ­£å¸¸è¿æ¥
INFO: Registered to VPS successfully
INFO: gRPC channel to VPS established successfully

# è¿æ¥ä¸¢å¤±
WARNING: Heartbeat timeout: 16.2s > 15s
ERROR: Connection error (attempt 1): Heartbeat timeout detected

# é‡è¿å°è¯•
INFO: Reconnecting in 2 seconds... (attempt 1/10)
INFO: Attempting to reconnect...

# é‡è¿æˆåŠŸ
INFO: Node service (attempt 2)
INFO: gRPC channel to VPS established successfully
INFO: Registered to VPS successfully
```

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ç½‘ç»œç¯å¢ƒä¼˜åŒ–
- **å±€åŸŸç½‘**: ä½¿ç”¨è¾ƒçŸ­çš„å¿ƒè·³é—´éš” (2-5ç§’)
- **å¹¿åŸŸç½‘**: ä½¿ç”¨è¾ƒé•¿çš„å¿ƒè·³é—´éš” (5-10ç§’)
- **ä¸ç¨³å®šç½‘ç»œ**: å¢åŠ é‡è¯•æ¬¡æ•°å’Œè¶…æ—¶æ—¶é—´

### 2. èµ„æºä½¿ç”¨ä¼˜åŒ–
- **CPUå¯†é›†å‹**: å¢åŠ æ‰§è¡Œè¶…æ—¶æ—¶é—´
- **å†…å­˜å—é™**: å‡å°‘æœ€å¤§é˜Ÿåˆ—å¤§å°
- **ç½‘ç»œå¸¦å®½å—é™**: è°ƒæ•´æ¶ˆæ¯å¤§å°é™åˆ¶

### 3. å¯é æ€§ vs æ€§èƒ½æƒè¡¡
- **é«˜å¯é æ€§**: æ›´é¢‘ç¹çš„å¥åº·æ£€æŸ¥ï¼Œæ›´å¤šé‡è¯•
- **é«˜æ€§èƒ½**: è¾ƒå°‘çš„æ£€æŸ¥é¢‘ç‡ï¼Œæ›´å¤§çš„è¶…æ—¶å€¼

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. èŠ‚ç‚¹æ— æ³•é‡è¿
**ç—‡çŠ¶**: æœåŠ¡å™¨é‡å¯åèŠ‚ç‚¹æ˜¾ç¤ºè¿æ¥å¤±è´¥  
**è§£å†³**: 
- æ£€æŸ¥æœåŠ¡å™¨åœ°å€å’Œç«¯å£
- å¢åŠ  `max_retry_attempts`
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 2. é‡è¿é¢‘ç‡è¿‡é«˜
**ç—‡çŠ¶**: èŠ‚ç‚¹é¢‘ç¹é‡è¿ï¼Œæ¶ˆè€—èµ„æº  
**è§£å†³**:
- å¢åŠ  `reconnect_interval`
- è°ƒæ•´ `heartbeat_timeout`
- ä¼˜åŒ–ç½‘ç»œç¨³å®šæ€§

#### 3. å¿ƒè·³è¶…æ—¶
**ç—‡çŠ¶**: é¢‘ç¹çš„å¿ƒè·³è¶…æ—¶è­¦å‘Š  
**è§£å†³**:
- å¢åŠ  `heartbeat_timeout`
- å‡å°‘ `heartbeat_interval`
- æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ

#### 4. å‡½æ•°æ‰§è¡Œä¸­æ–­
**ç—‡çŠ¶**: é‡è¿æ—¶æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°è¢«ä¸­æ–­  
**è§£å†³**:
- å¢åŠ  `execution_timeout`
- å®ç°å‡½æ•°é‡è¯•æœºåˆ¶
- ä½¿ç”¨å¹‚ç­‰æ€§è®¾è®¡

### è¯Šæ–­å‘½ä»¤

```python
# æ£€æŸ¥è¿æ¥çŠ¶æ€
print(f"è¿æ¥çŠ¶æ€: {node._connection_healthy}")
print(f"é‡è¿æ¬¡æ•°: {node._reconnect_count}")
print(f"æœ€åå¿ƒè·³: {node._last_heartbeat_time}")

# æ£€æŸ¥æ´»è·ƒä»»åŠ¡
print(f"æ´»è·ƒæ‰§è¡Œ: {len(node._active_executions)}")
print(f"æ‰§è¡Œä»»åŠ¡: {len(node._execution_tasks)}")
```

## ğŸš€ å‡çº§æŒ‡å—

### ä»æ—§ç‰ˆæœ¬å‡çº§

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨æ—§ç‰ˆæœ¬çš„ EasyRemoteï¼Œå‡çº§æ­¥éª¤ï¼š

1. **æ›´æ–°ä»£ç **:
   ```bash
   pip install -e . --upgrade
   ```

2. **æ›´æ–°èŠ‚ç‚¹é…ç½®**:
   ```python
   # æ—§ç‰ˆæœ¬
   node = ComputeNode("server:8080", "node-id")
   
   # æ–°ç‰ˆæœ¬ï¼ˆæ¨èé…ç½®ï¼‰
   node = ComputeNode(
       vps_address="server:8080",
       node_id="node-id",
       reconnect_interval=3,
       max_retry_attempts=10,
       heartbeat_timeout=15
   )
   ```

3. **æµ‹è¯•é‡è¿åŠŸèƒ½**:
   ä½¿ç”¨æä¾›çš„æµ‹è¯•ç¨‹åºéªŒè¯é‡è¿æœºåˆ¶å·¥ä½œæ­£å¸¸ã€‚

### ç‰ˆæœ¬å…¼å®¹æ€§
- âœ… å‘åå…¼å®¹ï¼šæ—§çš„ä»£ç æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨
- âœ… æ¸è¿›å¼å¢å¼ºï¼šå¯ä»¥é€æ­¥æ·»åŠ æ–°çš„é…ç½®å‚æ•°
- âœ… é»˜è®¤å€¼ä¼˜åŒ–ï¼šå³ä½¿ä¸é…ç½®æ–°å‚æ•°ä¹Ÿèƒ½è·å¾—æ”¹è¿›çš„é‡è¿æ€§èƒ½

## ğŸ“ æœ€ä½³å®è·µ

1. **ç”Ÿäº§ç¯å¢ƒé…ç½®**:
   ```python
   node = ComputeNode(
       vps_address="prod-server:8080",
       node_id=f"prod-node-{socket.gethostname()}",
       reconnect_interval=5,
       max_retry_attempts=20,
       heartbeat_interval=10,
       heartbeat_timeout=30,
       health_check_interval=60
   )
   ```

2. **å¼€å‘ç¯å¢ƒé…ç½®**:
   ```python
   node = ComputeNode(
       vps_address="localhost:8080",
       node_id="dev-node",
       reconnect_interval=1,
       max_retry_attempts=5,
       heartbeat_interval=3,
       heartbeat_timeout=10
   )
   ```

3. **ç›‘æ§é›†æˆ**:
   - ä½¿ç”¨æ—¥å¿—èšåˆå·¥å…·æ”¶é›†é‡è¿æ—¥å¿—
   - è®¾ç½®é‡è¿å¤±è´¥å‘Šè­¦
   - ç›‘æ§èŠ‚ç‚¹å¥åº·çŠ¶æ€

4. **é«˜å¯ç”¨éƒ¨ç½²**:
   - éƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹å®ä¾‹
   - ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨
   - å®ç°èŠ‚ç‚¹æ•…éšœåˆ‡æ¢

é€šè¿‡è¿™äº›æ”¹è¿›ï¼ŒEasyRemote ç°åœ¨èƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç†ç½‘ç»œä¸­æ–­å’ŒæœåŠ¡å™¨é‡å¯ï¼Œç¡®ä¿ä½ çš„åˆ†å¸ƒå¼è®¡ç®—ä»»åŠ¡çš„å¯é æ€§ï¼ ğŸ‰ 