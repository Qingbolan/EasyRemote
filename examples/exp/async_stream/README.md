# EasyRemote Async & Streaming Test Environment

è¿™ä¸ªæµ‹è¯•ç¯å¢ƒä¸“é—¨ç”¨äºæµ‹è¯• EasyRemote çš„å¼‚æ­¥å’Œæµå¼åŠŸèƒ½ã€‚

## ğŸ“ æ–‡ä»¶ç»“æ„

```
async_stream/
â”œâ”€â”€ server.py          # ç½‘å…³æœåŠ¡å™¨
â”œâ”€â”€ compute_node.py    # è®¡ç®—èŠ‚ç‚¹ï¼ˆåŒ…å«å„ç§æµ‹è¯•å‡½æ•°ï¼‰
â”œâ”€â”€ client.py          # æµ‹è¯•å®¢æˆ·ç«¯
â””â”€â”€ README.md          # è¯´æ˜æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä¸€é”®è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
cd examples/exp/async_stream
python run_tests.py
```

### æ–¹æ³•äºŒï¼šåˆ†æ­¥è¿è¡Œ
#### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
python server.py
```

#### 2. å¯åŠ¨è®¡ç®—èŠ‚ç‚¹
åœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­ï¼š
```bash
python compute_node.py
```

#### 3. è¿è¡Œæµ‹è¯•å®¢æˆ·ç«¯
åœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯çª—å£ä¸­ï¼š
```bash
python client.py
```

### æ–¹æ³•ä¸‰ï¼šå¿«é€ŸéªŒè¯ä¿®å¤
```bash
# ç¡®ä¿æœåŠ¡å™¨å’Œè®¡ç®—èŠ‚ç‚¹å·²å¯åŠ¨ï¼Œç„¶åè¿è¡Œï¼š
python verify_fix.py
```

### æ–¹æ³•å››ï¼šè¯¦ç»†æµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š
python test_fix.py
```

## ğŸ“‹ æµ‹è¯•åŠŸèƒ½

### åŒæ­¥å‡½æ•° (Synchronous Functions)
- `sync_add(a, b)` - ç®€å•çš„åŠ æ³•è¿ç®—
- `sync_process_data(data)` - æ•°æ®å¤„ç†

### å¼‚æ­¥å‡½æ•° (Asynchronous Functions)
- `async_computation(data, delay)` - å¼‚æ­¥è®¡ç®—ï¼Œæ”¯æŒå»¶è¿Ÿå‚æ•°
- `async_ai_simulation(text, model_delay)` - æ¨¡æ‹ŸAIå¤„ç†

### æµå¼å‡½æ•° (Streaming Functions)
- `sync_number_stream(start, count, interval)` - åŒæ­¥æ•°å­—æµ
- `async_data_stream(config)` - å¼‚æ­¥ä¼ æ„Ÿå™¨æ•°æ®æµ
- `async_ml_inference_stream(images, batch_size)` - å¼‚æ­¥MLæ¨ç†æµ
- `async_complex_pipeline(data_source, config)` - å¤æ‚å¼‚æ­¥ç®¡é“

## ğŸ”§ é…ç½®å‚æ•°

### å¼‚æ­¥æ•°æ®æµé…ç½®
```python
config = {
    'sensors': ['temperature', 'humidity', 'pressure'],
    'sample_rate': 2,  # æ¯ç§’é‡‡æ ·æ•°
    'duration': 10     # æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰
}
```

### MLæ¨ç†æµé…ç½®
```python
images = ['image_001.jpg', 'image_002.jpg', ...]
batch_size = 2  # æ‰¹å¤„ç†å¤§å°
```

### å¤æ‚ç®¡é“é…ç½®
```python
config = {
    'stages': 3,           # å¤„ç†é˜¶æ®µæ•°
    'items_per_stage': 5,  # æ¯é˜¶æ®µé¡¹ç›®æ•°
    'stage_delay': 1.0     # æ¯é˜¶æ®µå»¶è¿Ÿï¼ˆç§’ï¼‰
}
```

## ğŸ“Š æµ‹è¯•åœºæ™¯

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
- åŒæ­¥å‡½æ•°è°ƒç”¨
- å¼‚æ­¥å‡½æ•°è°ƒç”¨
- æ€§èƒ½å¯¹æ¯”

### 2. æµå¼æ•°æ®å¤„ç†
- å®æ—¶ä¼ æ„Ÿå™¨æ•°æ®æ¨¡æ‹Ÿ
- æ‰¹é‡å›¾åƒå¤„ç†
- å¤šé˜¶æ®µæ•°æ®ç®¡é“

### 3. å¹¶å‘å¤„ç†
- å¤šä¸ªå¼‚æ­¥ä»»åŠ¡å¹¶å‘æ‰§è¡Œ
- æµå¼æ•°æ®çš„å®æ—¶å¤„ç†
- èµ„æºç®¡ç†å’Œæ¸…ç†

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### æ‰‹åŠ¨æµ‹è¯•å•ä¸ªå‡½æ•°
```python
from easyremote import Client

client = Client("localhost:8080")

# æµ‹è¯•å¼‚æ­¥è®¡ç®—
result = client.execute("async_computation", [1, 2, 3, 4, 5], 2.0)
print(result)

# æµ‹è¯•æ•°æ®æµ
config = {'sensors': ['temperature'], 'sample_rate': 1, 'duration': 5}
stream_result = client.execute("async_data_stream", config)
print(stream_result)
```

### è‡ªå®šä¹‰æµ‹è¯•
ä½ å¯ä»¥ä¿®æ”¹ `client.py` ä¸­çš„æµ‹è¯•å‚æ•°æ¥è¿›è¡Œè‡ªå®šä¹‰æµ‹è¯•ï¼š

```python
# ä¿®æ”¹å¼‚æ­¥è®¡ç®—å‚æ•°
result = client.execute("async_computation", [10, 20, 30], 3.0)

# ä¿®æ”¹æµå¼é…ç½®
config = {
    'sensors': ['temperature', 'humidity', 'pressure'],
    'sample_rate': 5,  # æ›´é«˜çš„é‡‡æ ·ç‡
    'duration': 15     # æ›´é•¿çš„æŒç»­æ—¶é—´
}
```

## ğŸ” ç›‘æ§å’Œè°ƒè¯•

### æ—¥å¿—è¾“å‡º
æ‰€æœ‰ç»„ä»¶éƒ½é…ç½®äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥è§‚å¯Ÿï¼š
- å‡½æ•°è°ƒç”¨æ—¶é—´
- æ•°æ®å¤„ç†è¿›åº¦
- é”™è¯¯å’Œå¼‚å¸¸ä¿¡æ¯

### æ€§èƒ½ç›‘æ§
- å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œæ—¶é—´
- æµå¼æ•°æ®çš„ååé‡
- å†…å­˜å’ŒCPUä½¿ç”¨æƒ…å†µ

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å†²çª**: ç¡®ä¿ç«¯å£ 8080 æ²¡æœ‰è¢«å…¶ä»–ç¨‹åºå ç”¨
2. **ä¾èµ–å®‰è£…**: ç¡®ä¿å·²å®‰è£… EasyRemote åŠå…¶ä¾èµ–
3. **å¯åŠ¨é¡ºåº**: å…ˆå¯åŠ¨æœåŠ¡å™¨ï¼Œå†å¯åŠ¨è®¡ç®—èŠ‚ç‚¹ï¼Œæœ€åè¿è¡Œå®¢æˆ·ç«¯
4. **èµ„æºæ¸…ç†**: æµ‹è¯•å®Œæˆåè®°å¾—åœæ­¢æ‰€æœ‰è¿›ç¨‹

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **è¿æ¥å¤±è´¥**: æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. **å‡½æ•°æœªæ‰¾åˆ°**: ç¡®ä¿è®¡ç®—èŠ‚ç‚¹å·²è¿æ¥å¹¶æ³¨å†Œå‡½æ•°
3. **æµå¼æ•°æ®å¼‚å¸¸**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œè¶…æ—¶è®¾ç½®
4. **åºåˆ—åŒ–é”™è¯¯**: ç¡®ä¿æµå¼å‡½æ•°ä½¿ç”¨äº†æ­£ç¡®çš„è£…é¥°å™¨å‚æ•°

### æµå¼å‡½æ•°å®ç°æ–¹æ¡ˆ

#### ğŸš¨ å½“å‰å®ç°çš„é—®é¢˜
ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°å½“å‰çš„"æ”¶é›†å¼æµå¼å¤„ç†"å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **ä¸æ˜¯çœŸæ­£çš„æµå¼å¤„ç†**ï¼šæ‰€æœ‰æ•°æ®è¢«æ”¶é›†åä¸€æ¬¡æ€§è¿”å›ï¼Œå¤±å»å®æ—¶æ€§
2. **å†…å­˜æ•ˆç‡ä½**ï¼šéœ€è¦å­˜å‚¨æ‰€æœ‰ä¸­é—´ç»“æœ
3. **æ— æ³•å¤„ç†æ— é™æµ**ï¼šä¸é€‚åˆæŒç»­çš„æ•°æ®æµåœºæ™¯
4. **ç”¨æˆ·ä½“éªŒå·®**ï¼šå®¢æˆ·ç«¯æ— æ³•è·å¾—å®æ—¶è¿›åº¦æ›´æ–°

#### ğŸ“Š å®ç°æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å®æ—¶æ€§ | å†…å­˜æ•ˆç‡ | æ— é™æµæ”¯æŒ | å®ç°å¤æ‚åº¦ |
|------|--------|----------|------------|------------|
| æ”¶é›†å¼æµå¼ | âŒ æ—  | âŒ ä½ | âŒ ä¸æ”¯æŒ | âœ… ç®€å• |
| çœŸæ­£æµå¼ | âœ… å®æ—¶ | âœ… é«˜ | âœ… æ”¯æŒ | âš ï¸ ä¸­ç­‰ |

#### ğŸ”§ å½“å‰çš„æƒå®œæ–¹æ¡ˆï¼ˆæ”¶é›†å¼ï¼‰
```python
# âœ… å½“å‰å¯ç”¨çš„å®ç°æ–¹å¼ï¼ˆè‡ªåŠ¨æ£€æµ‹å‡½æ•°ç±»å‹ï¼‰
@node.register()
def sync_stream_function(count: int) -> str:
    """åŒæ­¥æµå¼å‡½æ•° - è¿”å›æ”¶é›†çš„æµæ•°æ®"""
    results = []
    for i in range(count):
        data = {"item": i, "timestamp": datetime.now().isoformat()}
        results.append(json.dumps(data))
        time.sleep(0.1)  # æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
    return "\n".join(results) + "\n"

@node.register()
async def async_stream_function(config: dict) -> str:
    """å¼‚æ­¥æµå¼å‡½æ•° - è¿”å›æ”¶é›†çš„æµæ•°æ®"""
    results = []
    for i in range(config.get('count', 5)):
        data = {"item": i, "timestamp": datetime.now().isoformat()}
        results.append(json.dumps(data))
        await asyncio.sleep(0.1)  # å¼‚æ­¥ç­‰å¾…
    return "\n".join(results) + "\n"
```

#### ğŸ¯ ç†æƒ³çš„çœŸæ­£æµå¼å®ç°
```python
# ğŸš€ çœŸæ­£çš„æµå¼å¤„ç†ï¼ˆéœ€è¦ EasyRemote å¼•æ“æ”¹è¿›ï¼‰
@node.register(stream=True)
def true_sync_stream(count: int) -> Generator[Dict[str, Any], None, None]:
    """çœŸæ­£çš„åŒæ­¥æµå¼å‡½æ•°"""
    for i in range(count):
        data = {"item": i, "timestamp": datetime.now().isoformat()}
        yield data  # å®æ—¶äº§ç”Ÿæ•°æ®
        time.sleep(0.1)

@node.register(stream=True)
async def true_async_stream(config: dict) -> AsyncGenerator[Dict[str, Any], None]:
    """çœŸæ­£çš„å¼‚æ­¥æµå¼å‡½æ•°"""
    for i in range(config.get('count', 5)):
        data = {"item": i, "timestamp": datetime.now().isoformat()}
        yield data  # å®æ—¶äº§ç”Ÿæ•°æ®
        await asyncio.sleep(0.1)
```

#### âŒ é¿å…ä½¿ç”¨çš„æ–¹å¼
```python
# âŒ ä¼šå¯¼è‡´åºåˆ—åŒ–é”™è¯¯
@node.register()
def generator_function():
    yield data  # ç”Ÿæˆå™¨å¯¹è±¡æ— æ³•æ­£ç¡®åºåˆ—åŒ–

# âŒ ä¼šå¯¼è‡´æ‰§è¡Œé”™è¯¯
@node.register(function_type=FunctionType.GENERATOR)
def explicit_generator():
    yield data
```

#### ğŸ“‹ æ”¹è¿›å»ºè®®
æŸ¥çœ‹ `streaming_analysis.md` è·å–è¯¦ç»†çš„é—®é¢˜åˆ†æå’Œæ”¹è¿›æ–¹æ¡ˆã€‚

### æµå¼æ•°æ®æ ¼å¼
è¿”å›çš„å­—ç¬¦ä¸²æ ¼å¼ä¸ºæ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼š
```
{"item": 1, "timestamp": "2025-05-25T17:40:00"}
{"item": 2, "timestamp": "2025-05-25T17:40:01"}
{"item": 3, "timestamp": "2025-05-25T17:40:02"}
```

### è°ƒè¯•æŠ€å·§
- æŸ¥çœ‹æ—¥å¿—è¾“å‡ºäº†è§£è¯¦ç»†ä¿¡æ¯
- ä½¿ç”¨è¾ƒå°çš„æµ‹è¯•å‚æ•°è¿›è¡Œåˆæ­¥éªŒè¯
- é€ä¸ªæµ‹è¯•åŠŸèƒ½æ¨¡å—
- ä½¿ç”¨ `test_fix.py` å¿«é€ŸéªŒè¯æµå¼åŠŸèƒ½

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½

ä½ å¯ä»¥åŸºäºè¿™ä¸ªæµ‹è¯•ç¯å¢ƒæ‰©å±•æ›´å¤šåŠŸèƒ½ï¼š
- æ·»åŠ æ–°çš„å¼‚æ­¥å‡½æ•°
- å®ç°æ›´å¤æ‚çš„æµå¼å¤„ç†é€»è¾‘
- é›†æˆçœŸå®çš„AIæ¨¡å‹
- æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

## ğŸ‰ å¼€å§‹æµ‹è¯•

ç°åœ¨ä½ å¯ä»¥å¼€å§‹æµ‹è¯• EasyRemote çš„å¼‚æ­¥å’Œæµå¼åŠŸèƒ½äº†ï¼æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤å¯åŠ¨å„ä¸ªç»„ä»¶ï¼Œç„¶åè§‚å¯Ÿæµ‹è¯•ç»“æœã€‚ 